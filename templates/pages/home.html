{% extends "base.html" %}
{% load static i18n %}

{% block title %}{% trans "Главная" %}{% endblock %}

{% block content %}
<section class="hero container">
  <h1>{% trans "Всероссийский центр науки и инноваций" %}</h1>

  {# ── Строка поиска на главной ─────────────────────────────────────────────── #}
  <form class="search-form" action="{% url 'home' %}" method="get" style="margin-top:1rem;">
    <div class="search">
      <input
        type="text"
        name="q"
        value="{{ request.GET.q|default_if_none:'' }}"
        placeholder="{% trans 'Поиск мероприятий…' %}"
        aria-label="{% trans 'Поиск' %}">
      <button type="submit">{% trans "Найти" %}</button>
    </div>
  </form>

  {# ВАЖНО: здесь РАНЬШЕ была фраза про «Наградные документы…». Мы её УДАЛИЛИ по вашему запросу. #}
</section>

{# ── Сетка актуальных/избранных мероприятий ─────────────────────────────────── #}
<section class="container" style="margin-top:2rem;">
  <h2 style="margin-bottom:1rem;">{% trans "Актуальные мероприятия" %}</h2>

  {% if featured_events %}
    <div class="cards events-grid">
      {% for event in featured_events %}
        <article class="card event-card">
          <div class="card-body">
            <h3 class="card-title">
              <a href="{% if event.get_absolute_url %}{{ event.get_absolute_url }}{% elif event.slug %}{% url 'events:detail' event.slug %}{% else %}#{% endif %}">
                {{ event.title|default:"Без названия" }}
              </a>
            </h3>

            {% if event.short_description %}
              <p class="card-text">{{ event.short_description }}</p>
            {% elif event.description %}
              <p class="card-text">{{ event.description|truncatechars:160 }}</p>
            {% endif %}

            <div class="card-meta" style="font-size:.9rem;opacity:.9;">
              {% if event.start_date %}<span>🗓 {{ event.start_date }}</span>{% endif %}
              {% if event.category %}<span>• {{ event.category }}</span>{% endif %}
              {% if event.is_online %}<span>• {% trans "онлайн" %}</span>{% endif %}
            </div>

            <div class="card-actions" style="display:flex;gap:.5rem;flex-wrap:wrap;margin-top:.75rem;">
              {# КНОПКА РЕГИСТРАЦИИ — выбираем существующее поле/метод, ничего в бэкенде не меняем #}
              {% if event.registration_url %}
                <a class="btn" href="{{ event.registration_url }}" rel="noopener" target="_blank">{% trans "Регистрация" %}</a>
              {% elif event.get_register_url %}
                <a class="btn" href="{{ event.get_register_url }}">{{ _("Регистрация") }}</a>
              {% elif event.slug %}
                {# стандартный fallback на именованный роут вида events:register <slug> #}
                <a class="btn" href="{% url 'events:register' event.slug %}">{% trans "Регистрация" %}</a>
              {% else %}
                {# если нет URL регистрации — прячем кнопку, ничего не ломаем #}
              {% endif %}

              {# КНОПКА «ИНФОРМАЦИОННОЕ ПИСЬМО» — используем filefield/URL, если присутствует #}
              {% if event.info_letter %}
                <a class="btn btn-secondary" href="{{ event.info_letter.url }}" download>
                  {% trans "Информационное письмо" %}
                </a>
              {% elif event.info_letter_url %}
                <a class="btn btn-secondary" href="{{ event.info_letter_url }}" rel="noopener" target="_blank">
                  {% trans "Информационное письмо" %}
                </a>
              {% endif %}

              {# Ссылка «Подробнее» #}
              <a class="btn-outline" href="{% if event.get_absolute_url %}{{ event.get_absolute_url }}{% elif event.slug %}{% url 'events:detail' event.slug %}{% else %}#{% endif %}">
                {% trans "Подробнее" %}
              </a>
            </div>
          </div>
        </article>
      {% endfor %}
    </div>
  {% else %}
    <p style="opacity:.8;">{% trans "Сейчас нет опубликованных мероприятий." %}</p>
  {% endif %}
</section>

{% endblock %}
