{% comment %} Events list (defensive with info_file_exists) {% endcomment %}
<h1>{{ page_title }}</h1>

<form method="get" class="search-form">
  <input type="text" name="q" value="{{ q }}" placeholder="Поиск...">
  <button type="submit">Искать</button>
</form>

<ul class="events-list">
  {% for ev in events %}
    <li class="event-item">
      <h2><a href="{{ ev.get_absolute_url }}">{{ ev.title }}</a></h2>
      {% if ev.event_date %}<div class="date">{{ ev.event_date }}</div>{% endif %}
      <div class="excerpt">{{ ev.description|truncatewords:30|safe }}</div>
      <div class="actions">
        <a class="nav-btn" href="{{ ev.get_absolute_url }}">Подробнее</a>
        {% if ev.info_file_exists %}
          <a class="nav-btn nav-btn--primary" href="{% url 'events:event_info_download' ev.slug %}" target="_blank" rel="noopener">Инф. письмо</a>
        {% elif ev.info_letter %}
          <a class="nav-btn nav-btn--primary" href="{{ ev.info_letter.url }}" download target="_blank" rel="noopener">Инф. письмо</a>
        {% endif %}
      </div>
    </li>
  {% empty %}
    <li>Мероприятий не найдено.</li>
  {% endfor %}
</ul>
